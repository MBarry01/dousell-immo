const { createClient } = require('@supabase/supabase-js');
const dotenv = require('dotenv');
const path = require('path');

console.log("Script JS starting...");

dotenv.config({ path: path.resolve(process.cwd(), '.env.local') });

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

async function run() {
  console.log("Searching for Kidira...");
  
  const { data: properties, error } = await supabase
    .from('properties')
    .select('id, title, location');

  if (error) {
    console.error("Error:", error);
    return;
  }

  const kidira = properties.filter(p => {
    const s = JSON.stringify(p.location || {}).toLowerCase();
    return s.includes('kidira');
  });

  console.log(`Found ${kidira.length} properties mentioning Kidira.`);
  
  kidira.forEach(p => {
    console.log(`- [${p.id}] ${p.title}`);
    console.log(`  Location:`, p.location);
    console.log(`  Coords:`, p.location?.coords);
  });
}

run();